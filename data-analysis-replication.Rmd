---
title: "Data Analysis Replication"
author: "Landon Porter"
date: "4/17/2022"
output: html_document 
---


These are some {knitr} options used to format the 
***RMarkdown*** documents in a consistent way. 
I am also reading in all of the packages I will need for my replication in the code below.

```{r setup, include=FALSE}



#library all of the necessary packages not found in base R 
library(tidyverse)
library(ggplot2)
library(dplyr)
library(ggthemes)
library(extrafont)
library(readr)
library(stats)
library(car)
library(mosaic)
library(infer)
library(coin)
library(jmuOutlier)


```




## Introduction 

In this paper the authors Dass et al. investigate the mechanism by which Toxoplasma gondii (a parasitic protozoan) induces behavioral changes in rats. They show that Toxoplasma gondii infections results in a change in the DNA methylation of arginine vasopressin (AVP) within the medial amygdala of male rats. Specifically, they demonstrated that hypomethylation of the AVP promoter caused an increase in AVP expression within infected rats.  This increase in AVT expression results in shocking behavioral changes. (I.e., affiliation to cat urine which assists in parasite’s transmission to its next host, -meow-). 

In order to quantify the difference in AVT methylation between infected and non-infected (control) rats, the authors generated data and conducted analyses which I will be replicating in this project. To briefly summarize, methylation of AVP promoter was quantified using methylation sensitive restriction enzymes (either HpaII or BstUI) in combination with qualitative PCR (internal control = no enzyme treatment for both infected and non-infected groups). These enzymes selectively degrade DNA which is not methylated. Hypomethylation in each enzyme treated assay therefore manifests in reduced production of DNA templet via PCR. 

Due to the degradation of hypomethylated AVP-DNA, infected samples required a greater number of PCR cycles to reach threshold (Ct) compared to infected samples with no methylation sensitive digestion enzymes (8/8 infected rats sampled). Interestingly, DNA samples from control rats NOT infected with Toxoplasma gondii also required a greater number of PCR cycles to reach threshold (Ct) when treated with either HpaII or BstUI compared to no enzyme (7/8 control rats sampled). However, the difference in Ct (Delta-Ct) between enzyme vs no enzyme treatments in control animals was not as large the Delta-Ct observed in experimental animals!  This suggests two things 1) that in non-infected control rats the AVT gene is not completely methylated and 2) that infected rats have substantially more non-methylated AVT.This result was depicted in Fig1A-D for which I will be replicating the visualization. 

For the data illustrated in Fig1A specifically, an arbitrary index of departure from chance (x = y; grey line in Fig. 1A) was calculated as (x - y)2 divided by (x + y)2, where x and y are Ct value without HpaII enzyme and with HpaII enzyme, respectively. They found that among experimental groups, infected animals exhibited greater departure (mean +/- SEM: control = 0.0004 +/- 0.00013, infected = 0.0028 +/- 0.00095; |t14| = 2.45, P = 0.028, independent sample t-test). I will be replicating the descriptive statistic they performed for for Fig1A-B. Also, in an attempt to replicate an inferential statistic from the paper, I will be running a T-test on the data illustrated in Fig1A, as was done in the paper. 

The experimenters went on to conduct behavioral experiments to parse out the consequences of parasite induced AVT-hypomethylation (affiliation to cat urine). They finished by conducting rescue experiments in which infected rates were treated with methionine and aberrant behaviors were abolished. 

For this project, however, I will focus on the results from the first experimental assays and attempt to replicate the data visualizations and statistical analyses the authors used to inform their conclusions. Specifically, I will be replicating 4 data visualizations (Fig1 A-D), 2 inferential statistics (T-test, ANOVA, and exact binomial test), and 4 descriptive statistic (mean and SEM for Control and Infected groups for each enzyme assay). 






##Visualization of Fig1 A and B 


FIGURE 1A SCATTER PLOT REPLICATION 

In the following code chunk I will attempt to replicate the scatter plot shown in Fig1A 

Scatter plot description: Scatter Plot of Ct values (X= Ct without enzyme, Y= Ct with enzyme) for both control (Pink) and infected (Blue) groups. (y = x line indicates equal Ct for both enzyme and non-enzyme treated assays)

```{r}

#importing and visualizing the data set from github repository  

data <- read_csv("https://raw.githubusercontent.com/lbp576/data-analysis-replication/main/data/fig1AB.csv")

#to view the entire data frame 
data

#view/read data using head() function to see only the first 6 rows
head(data)


#function for setting the theme
set_theme_plotly = function(){
  theme_set(theme_classic())
}


#Scatter plot for Fig1A (Enzyme: HpaII)
p <- ggplot(data=data, aes(x=Without_Enzyme, y=With_Enzyme, colour = Infected)) 
p <- p + geom_point(size=3, show.legend=TRUE) + xlim(c(20,36)) + ylim(c(20,36))
#geom_line function is used here to indicate zero methylation
p <- p + geom_abline()
p

```

Scatter plot interpretation: Toxoplasma gondii infection resulted in higher Ct value in HpaII enzyme treated assays compared to assays with no enzyme treatment. Both control and infected groups showed increase in Ct values after enzyme treatment; however, the distance from y = x line was larger for data points corresponding to the infected group (Blue) compared to control (Pink). 


Fig 1A scatter plot from paper for comparison: 

```{r eco=FLASE, Width="300px", message=FALSE}
knitr::include_graphics("https://github.com/lbp576/data-analysis-replication/blob/main/images/Fig1A.JPG")
```




FIGURE 1B BOX PLOT REPLICATION 

In the following code chunk I will attempt to replicate the box plot shown in Fig1B 

Box plot description: Box plot showing the distribution of the numerical data for Delta Ct in either the control or infected groups.  

```{r}

# Box plot for fig 1B (Enzyme: HpaII)
fig1B <- boxplot(data$Change_in_CT ~ data$Infected,
          ylab="Change in Ct", 
          xlab = "",                        
          main="HpaII boxplot",
          color = "group", 
          col=c("light green","red"))
```

Box plot Interpretation: On average, Toxoplasma gondii infection resulted in larger Delta Ct values (more negative) for data corresponding to infected rats compared to data for rats not infected. This comparatively large Delta Ct seen in the infected group is due to increase in hypomethylation and higher HpaII mediated degradation of non-methlyated AVP-DNA compared to control group. The inter-group difference visualized here is striking: the 75th percentile of Delta Ct values in the infected was placed below the 25th percentile of control animals.     


Fig 1B Box Plot from paper for comparison: 

```{r eco=FLASE, Width="300px", message=FALSE}
knitr::include_graphics("https://github.com/lbp576/data-analysis-replication/blob/main/images/Fig1B.JPG")
```





##Descriptive Statistic Replication for Fig1A.

Again, for the data illustrated in Fig1A, the authors included an arbitrary index of departure from chance (x = y; grey line in Fig. 1A) was calculated as (x - y)2 divided by (x + y)2, where x and y are Ct value without HpaII enzyme and with HpaII enzyme, respectively. They found that among experimental groups, infected animals exhibited greater departure (mean +/- SEM: control = 0.0004 +/- 0.00013, infected = 0.0028 +/- 0.00095; |t14| = 2.45, P = 0.028, independent sample t-test). In the following code chunk I will be replicating the descriptive statistic. 


```{r}

#First we need to define our x and y values for each group (Control or Infected)
#Here I am starting with the Control group 

Cx <- data %>% filter(Infected == "Control") %>% pull(Without_Enzyme)
Cx
Cy <- data %>% filter(Infected == "Control") %>% pull(With_Enzyme)
Cy

#Plugging these variables into the equation used to measure departure (i.e. (x - y)2 divided by (x + y)2) generates a vector I am calling "Departure_Control"
Departure_Control <- ((Cx - Cy)^2 / (Cx + Cy)^2)
#Next take the mean of this vector and assign it a name
M <- mean(Departure_Control)
M

#Next take the standard deviation which will be used to calculate standard error in the mean or SEM 
sd <- sd(Departure_Control)
sd

#calculate SEM 
SEM <- (sd / (8)^0.5) 
SEM




#Repeat these steps for the Infected group
Ix <- data %>% filter(Infected == "Infected") %>% pull(Without_Enzyme)
Ix

Iy <- data %>% filter(Infected == "Infected") %>% pull(With_Enzyme)
Iy

Departure_Infected <- ((Ix - Iy)^2 / (Ix + Iy)^2)
M <- mean(Departure_Infected)
M

sd <- sd(Departure_Infected)
sd

SEM <- (sd / (8)^0.5) 
SEM
```

Interpretation of output: 
My output for the mean and SEM for both Control and Infected groups are consistent with the values reported in the paper!  
(mean +/- SEM: control = 0.0004 +/- 0.00013, infected = 0.0028 +/- 0.00095) 








##Inferential Statistic Replication for Fig1A.
In the paper a T-test was performed on the data used to construct Fig1A.   

```{r}
## T-statistic 


x <- data %>% filter(Infected == "Infected") %>% pull(Change_in_CT)
x
y <- data %>% filter(Infected == "Control") %>% pull(Change_in_CT)
y 

t.test(x,y)

#An alternative way (from t test) to compare the two group means (change in Ct for Infected vs Control)
model2 <- aov(Change_in_CT ~ Infected, data=data)
summary(model2)





#Empirical test using randomization to test significance of Infected vs Control on Change in Ct 

n <- length(data)
nperm <- 10000  # number of permutation simulations
# create a dummy vector to hold results for each permutation
permuted_diff <- vector(length = n)
test_data <- data
for (i in 1:nperm) {
    # scramble the Infected vector `sample()` with a vector as an argument yields a random permutation of the vector
    test_data$Infected <- sample(data$Infected)
    x <- test_data[test_data$Infected == "Infected", ]$Change_in_CT
    y <- test_data[test_data$Infected == "Control", ]$Change_in_CT
    permuted_diff[[i]] <- mean(x) - mean(y)
}


test_data

permuted_diff

histogram(as.numeric(permuted_diff), type = "count", xlab = "", ylab = "# Permutations", main = "Histogram of Permutation Distribution")
h



test_data$Infected <- sample(data$Infected)
    x <- test_data[test_data$Infected == "Infected", ]$Change_in_CT
    y <- test_data[test_data$Infected == "Control", ]$Change_in_CT
    permuted_diff <- mean(x) - mean(y)


    

















```





##Visualization of Fig1 C and D 


FIGURE 1B SCATTER PLOT REPLICATION 

Scatter plot description: Scatter Plot of Ct values (X= Ct without enzyme, Y=Ct with enzyme) for both control (Pink) and infected (Blue) groups. (y = x line indicates equal Ct for both enzyme and non-enzyme treated assays)


```{r}


#importing and visualizing the data set from github repository  

data2 <- read_csv("https://raw.githubusercontent.com/lbp576/data-analysis-replication/main/data/fig1CD.csv")

#to view the entire data frame 
data2

#to view/read data using head()
head(data2)



#Scatter Plot for Fig 1C (Enzyme: BstUI)
s <- ggplot(data=data2, aes(x=Without_Enzyme, y=With_Enzyme, colour = Infected)) 
s <- s + geom_point(size=3, show.legend=TRUE) + xlim(c(20,36)) + ylim(c(20,36))
#geom_line function is used here to indicate zero methylation
s <- s + geom_abline()
s
```

Scatter plot interpretation: Toxoplasma gondii infection resulted in higher Ct value in BstUI enzyme treated assays compared to assays with no enzyme treatment. Both control and infected groups showed increase in Ct values after enzyme treatment; however, the distance from y = x line was larger for data points corresponding to the infected group (Blue) compared to control (Pink). 


Fig 1C scatter plot from paper for comparison: 

```{r eco=FLASE, Width="300px", message=FALSE}
knitr::include_graphics("https://github.com/lbp576/data-analysis-replication/blob/main/images/Fig1C.JPG")
```




FIGURE 1D BOX PLOT REPLICATION 

Box plot description: Box plot showing the distribution of the numerical data for Delta Ct in either the control or infected groups this time with BstUI enzyme treatment.  


```{r}

#Box plot for fig 1D (Enzyme: BstUI)
fig1D <- boxplot(data2$Change_in_CT ~ data2$Infected,
                 ylab="Change in Ct", 
                 xlab = "",                        
                 main="BstUI boxplot",
                 color = "group", 
                 col=c("light green","red"))

```

Box plot Interpretation: On average, Toxoplasma gondii infection resulted in larger Delta Ct values (more negative) for data corresponding to infected rats compared to data for rats not infected. This comparatively large Delta Ct seen in the infected group is due to increase in hypomethylation and higher HpaII mediated degradation of non-methlyated AVP-DNA compared to control group. The inter-group difference visualized here is striking: the 75th percentile of Delta Ct values in the infected was placed below the 25th percentile of control animals.     


Fig 1D Box Plot from paper for comparison: 

```{r eco=FLASE, Width="300px", message=FALSE}
knitr::include_graphics("https://github.com/lbp576/data-analysis-replication/blob/main/images/Fig1D.JPG")
```


##Descriptive Statistic Replication for Fig1C. 

For the data illustrated in Fig1C, the authors again included an arbitrary index of departure from chance (x = y; grey line in Fig. 1C) was calculated as (x - y)2 divided by (x + y)2, where x and y are Ct value without BstUI enzyme and with BstUI enzyme, respectively. They again found that among experimental groups, infected animals exhibited greater departure (mean +/- SEM: control = 0.0009 +/- 0.00019, infected = 0.0067 +/- 0.00249; |t14| = 2.39, P = 0.039, independent sample t-test). In the following code chunk I will be replicating the descriptive statistic. 


```{r}

#Again we need to define our x and y values for each group (Control or Infected), this time for BstUI treatments. 
#Here I am starting with the Control group 

Cx <- data2 %>% filter(Infected == "Control") %>% pull(Without_Enzyme)
Cx
Cy <- data2 %>% filter(Infected == "Control") %>% pull(With_Enzyme)
Cy

#Plugging these variables into the equation used to measure departure (i.e. (x - y)2 divided by (x + y)2) generates a vector I am calling "Departure_Control"
Departure_Control <- ((Cx - Cy)^2 / (Cx + Cy)^2)
#Next take the mean of this vector and assign it a name
M <- mean(Departure_Control)
M

#Next take the standard deviation which will be used to calculate standard error in the mean or SEM 
sd <- sd(Departure_Control)
sd

#calculate SEM 
SEM <- (sd / (8)^0.5) 
SEM




#Repeat these steps for the Infected group
Ix <- data2 %>% filter(Infected == "Infected") %>% pull(Without_Enzyme)
Ix

Iy <- data2 %>% filter(Infected == "Infected") %>% pull(With_Enzyme)
Iy

Departure_Infected <- ((Ix - Iy)^2 / (Ix + Iy)^2)
M <- mean(Departure_Infected)
M

sd <- sd(Departure_Infected)
sd

SEM <- (sd / (8)^0.5) 
SEM
```

Interpretation of output: 
My output for the mean and SEM for both Control and Infected groups are consistent with the values reported in the paper; however, the mean calculated for the infected group is .0001 than the value reported in the paper (0.0067). This could be due to a small rounding error made by the authors.   
(mean +/- SEM: control = 0.0009 +/- 0.00019, infected = 0.0068 +/- 0.00249





##Summary / Discussion

Overall I really enjoyed the paper and I think the results they obtained were interesting. Replicating their figures was do-able but could have been a lot easier if they had structured their data in a more organized way. By this I mean that their excel file was not structured so that the data columns appear all together. The data are in various columns that are not all located at the top of the excel sheet as one would expect, rather they appear to be copy pasted into the middle of the excel sheet with no particular logical flow for the calculations and analyses they conducted. Due to this lack of organization in the excel sheet I had a really hard time getting the data into R in the form which they had it. Consequently, I had to copy paste the specific data I would be using for my visualization and statistics into a new, more organized excel files that could be easily read into R. Alternatively, I could have instructed R with parameters for reading in only select tabs and rows within the tabs; however, this takes considerable time and effort as well. Regardless, they could have structured their data in a way that is more conducive to reproducing their analyses. 

Secondly, regarding the statistic that were reported in the paper, there was a confusing discrepancy between the statistics that they stated were conducted in the "Statistics" section and the actual statistics they reported in the "Results" section. This made it challenging to reproduce the statistics since I initially set myself up to replicate one analysis but then upon looking at the statistics reported in the "Results" section I noticed they were actually obtaining their values using a different method. Overall I think they could have been more clear on the exact statistical tests they did for each experimental assay and I think they should have been more consistent.    
 



##References 

Hari Dass, Shantala Arundhati, and Ajai Vyas. “Toxoplasma gondii infection reduces predator aversion in rats through epigenetic modulation in the host medial amygdala.” Molecular ecology vol. 23,24 (2014): 6114-22. doi:10.1111/mec.12888


